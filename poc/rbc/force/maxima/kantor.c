kz = (bx-ax)*(cy-ay)-(by-ay)*(cx-ax)$
ky = (bz-az)*(cx-ax)-(bx-ax)*(cz-az)$
kx = (by-ay)*(cz-az)-(bz-az)*(cy-ay)$
nz = (cy-by)*(dx-bx)-(cx-bx)*(dy-by)$
ny = (cx-bx)*(dz-bz)-(cz-bz)*(dx-bx)$
nx = (cz-bz)*(dy-by)-(cy-by)*(dz-bz)$
kk = kz^2+ky^2+kx^2$
nn = nz^2+ny^2+nx^2$
kn = kz*nz+ky*ny+kx*nx$
rsq = 1/sqrt(kk*nn)$
E_kn = rsq$
E_rsq = kn$
rsq_kk = -nn/(2*(kk*nn)^(3/2))$
rsq_nn = -kk/(2*(kk*nn)^(3/2))$
E_kk = E_rsq*rsq_kk$
E_nn = E_rsq*rsq_nn$
kn_nx = kx$
kn_ny = ky$
kn_nz = kz$
kn_kx = nx$
kn_ky = ny$
kn_kz = nz$
E_nx = E_kn*kn_nx$
E_ny = E_kn*kn_ny$
E_nz = E_kn*kn_nz$
E_kx = E_kn*kn_kx$
E_ky = E_kn*kn_ky$
E_kz = E_kn*kn_kz$
nn_nx = 2*nx$
nn_ny = 2*ny$
nn_nz = 2*nz$
E_nx = E_nn*nn_nx$
E_ny = E_nn*nn_ny$
E_nz = E_nn*nn_nz$
kk_kx = 2*kx$
kk_ky = 2*ky$
kk_kz = 2*kz$
E_kx = E_kk*kk_kx$
E_ky = E_kk*kk_ky$
E_kz = E_kk*kk_kz$
nx_by = dz-cz$
nx_bz = cy-dy$
nx_cy = bz-dz$
nx_cz = dy-by$
nx_dy = cz-bz$
nx_dz = by-cy$
E_by = E_nx*nx_by$
E_bz = E_nx*nx_bz$
E_cy = E_nx*nx_cy$
E_cz = E_nx*nx_cz$
E_dy = E_nx*nx_dy$
E_dz = E_nx*nx_dz$
ny_bx = cz-dz$
ny_bz = dx-cx$
ny_cx = dz-bz$
ny_cz = bx-dx$
ny_dx = bz-cz$
ny_dz = cx-bx$
E_bx = E_ny*ny_bx$
E_bz = E_ny*ny_bz$
E_cx = E_ny*ny_cx$
E_cz = E_ny*ny_cz$
E_dx = E_ny*ny_dx$
E_dz = E_ny*ny_dz$
nz_bx = dy-cy$
nz_by = cx-dx$
nz_cx = by-dy$
nz_cy = dx-bx$
nz_dx = cy-by$
nz_dy = bx-cx$
E_bx = E_nz*nz_bx$
E_by = E_nz*nz_by$
E_cx = E_nz*nz_cx$
E_cy = E_nz*nz_cy$
E_dx = E_nz*nz_dx$
E_dy = E_nz*nz_dy$
kx_ay = bz-cz$
kx_az = cy-by$
kx_by = cz-az$
kx_bz = ay-cy$
kx_cy = az-bz$
kx_cz = by-ay$
E_ay = E_kx*kx_ay$
E_az = E_kx*kx_az$
E_by = E_kx*kx_by$
E_bz = E_kx*kx_bz$
E_cy = E_kx*kx_cy$
E_cz = E_kx*kx_cz$
ky_ax = cz-bz$
ky_az = bx-cx$
ky_bx = az-cz$
ky_bz = cx-ax$
ky_cx = bz-az$
ky_cz = ax-bx$
E_ax = E_ky*ky_ax$
E_az = E_ky*ky_az$
E_bx = E_ky*ky_bx$
E_bz = E_ky*ky_bz$
E_cx = E_ky*ky_cx$
E_cz = E_ky*ky_cz$
kz_ax = by-cy$
kz_ay = cx-bx$
kz_bx = cy-ay$
kz_by = ax-cx$
kz_cx = ay-by$
kz_cy = bx-ax$
E_ax = E_kz*kz_ax$
E_ay = E_kz*kz_ay$
E_bx = E_kz*kz_bx$
E_by = E_kz*kz_by$
E_cx = E_kz*kz_cx$
E_cy = E_kz*kz_cy$
