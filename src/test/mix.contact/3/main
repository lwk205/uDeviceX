#### contact force: several cell and rigid objects
# sTEST: mix.contact.t3
set -eu
cd test/mix.contact/3
X=32 Y=16 Z=16 R=7.5
rad=2.5 fr=0.1 sc=0.25 ang=0.0
SEED=123 plcmt.ro $X $Y $Z  $rad  $fr $sc $ang        rigs-ic.txt  rbcs-ic.txt
u.cp.rig cylinder      rig.ply
u.cp.rbc sph/sc/642    rbc.off
u.cp.rbc rbc/sc/642    ref.off
tsdf /dev/stdin sdf.dat sdf.vti <<EOF
    extent     $X $Y $Z
    N          $X $Y $Z
    obj_margin 3.0
    !cylinder axis 1 0 0 point xc yc zc radius $R
EOF
:
run () {
  u.run udx conf.cfg "
  time   = { type = \"const\"; wall = $wall; dt = $dt; end = $end }
  glb    = { restart = $restart; L = [$X, $Y, $Z] }
  vcon   = { active = $vcon; U  = [$U, 0.0, 0.0] }
  rbc    = {
      kBT = 0.0
      ks = 10.0
      kb = 100.0
      kd = 5000.0; ka =5000.0; kv = 5000.0
      stress_free      = true
      stress_free_file = \"ref.off\"
      totArea          = `off.area   ref.off`
      totVolume        = `off.volume ref.off`
  }"
}
u.strtdir .
restart=false dt=1e-4 U=0.0   end=10.0  wall=5.0 vcon=false run
restart=true  dt=5e-4 U=0.125 end=100.0          vcon=true  run
:
ply2punto r/00002.ply | uscale 0.1 > ply.out.txt
