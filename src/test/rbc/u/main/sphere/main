#### periodic box: sphering
# nTEST: rbc.u.main.sphere.0
set -eu
rm -rf bop diag.txt h5 ply rbc.off
:
S=`u.cp.s` U=u/rbc/main C=conf/lina.h
nv=642
cell="$S"/data/cells/rbc/$nv.off
cp $cell rbc.off
:
sph=1
volume=`off.sphericity2volume $sph $cell` : needs gitlab.ethz.ch:mavt-cse/off
area=`off.area $cell`
:
x=24 y=16 z=16; echo 1 0 0 $x  0 1 0 $y  0 0 1 $z  0 0 0 1 > rbcs-ic.txt
:
u.conf $S $U $C <<!
   rbcs
   MESH_SHIFT_CENTER RBC_CLEAR_VEL
   RBCtotArea=$area RBCtotVolume=$volume
   RBCnv=$nv RBC_RND=false
   dt=1e-3 tend=200.0
   run
!
{ make clean && u.make -j; } > /dev/null
:
u.run ./udx '
glb = {
    L = [48, 32, 32]
}
rbc = {
    @include "rbc.lina.cfg"
    kBT = 0.00444302;
    ks = 3.26692647;
}
restrain = {
    kind = "rbc";
    freq = 1000;
};
dump = {
    parts = true;
    freq_parts = 50000;
};'
ply2punto r/00003.ply | uscale 1 > ply.out.txt
